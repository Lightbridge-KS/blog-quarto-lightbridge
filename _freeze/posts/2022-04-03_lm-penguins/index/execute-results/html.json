{
  "hash": "c5753f40e146ca5c4fc18367477a214c",
  "result": {
    "markdown": "---\ntitle: \"Linear Regression Models\"\ndescription: \"Linear models with palmerpenguins\"\ndate: \"2022-04-03\"\ndraft: false # Will render locally only\ncategories: [\"R\", \"Stats\", \"Penguins\"]\nimage: feature.png\nbibliography: packages.bib\n---\n\n\n\nLet's explore linear regression models. The data I will be using is `penguins` dataset from [palmerpenguins](https://allisonhorst.github.io/palmerpenguins/index.html) package [@R-palmerpenguins].\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n```\n:::\n\n# Explore Data\n\nLet's see an overview of the data by visualizing the column names, types, and missing values.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nvisdat::vis_dat(penguins)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' fig-pos='h' width=1800}\n:::\n:::\n\nHere is the first few rows of the data.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhead(penguins)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-responsive\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> species </th>\n   <th style=\"text-align:left;\"> island </th>\n   <th style=\"text-align:right;\"> bill_length_mm </th>\n   <th style=\"text-align:right;\"> bill_depth_mm </th>\n   <th style=\"text-align:right;\"> flipper_length_mm </th>\n   <th style=\"text-align:right;\"> body_mass_g </th>\n   <th style=\"text-align:left;\"> sex </th>\n   <th style=\"text-align:right;\"> year </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 39.1 </td>\n   <td style=\"text-align:right;\"> 18.7 </td>\n   <td style=\"text-align:right;\"> 181 </td>\n   <td style=\"text-align:right;\"> 3750 </td>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 39.5 </td>\n   <td style=\"text-align:right;\"> 17.4 </td>\n   <td style=\"text-align:right;\"> 186 </td>\n   <td style=\"text-align:right;\"> 3800 </td>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 40.3 </td>\n   <td style=\"text-align:right;\"> 18.0 </td>\n   <td style=\"text-align:right;\"> 195 </td>\n   <td style=\"text-align:right;\"> 3250 </td>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 36.7 </td>\n   <td style=\"text-align:right;\"> 19.3 </td>\n   <td style=\"text-align:right;\"> 193 </td>\n   <td style=\"text-align:right;\"> 3450 </td>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Adelie </td>\n   <td style=\"text-align:left;\"> Torgersen </td>\n   <td style=\"text-align:right;\"> 39.3 </td>\n   <td style=\"text-align:right;\"> 20.6 </td>\n   <td style=\"text-align:right;\"> 190 </td>\n   <td style=\"text-align:right;\"> 3650 </td>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:right;\"> 2007 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\nFor quick overview `GGally::ggpairs()` can show relationship among penguin `species` and other numeric variables.\n\n::: {.cell layout-align=\"center\" hash='index_cache/html/ggpairs_d8a6f102fc69d3733895861e6e1ed0ed'}\n\n```{.r .cell-code}\npenguins %>%\n  select(species, body_mass_g, ends_with(\"_mm\")) %>%\n  GGally::ggpairs(aes(color = species)) +\n  \n  scale_fill_brewer(palette = \"Set2\") +\n  scale_color_brewer(palette = \"Set2\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/ggpairs-1.png){fig-align='center' fig-pos='h' width=1800}\n:::\n:::\n\nToday, I will focus on predicting **`body_mass_g`** of the penguins using linear regression models.\n\n# Simple Linear Regression Model\n\n::: callout-tip\n## Goal\n\nPredict `body_mass_g` using 1 predictor `bill_depth_mm`.\n:::\n\nlet's fit the simple linear regression model. The outcome variable is `body_mass_g` and the predictor is `bill_depth_mm`.\n\n## Plotting\n\nNow, Let's visualize a scatter plot between these 2 variables.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1 <- penguins %>% \n  ggplot(aes(bill_depth_mm, body_mass_g)) +\n  geom_point(color = \"cyan4\", alpha = 0.7) +\n  geom_smooth(method = \"lm\") +\n  labs(title = \"Simple Linear Regression\")\n\np1\n```\n\n::: {.cell-output-display}\n![Points represent each observations. Blue line is a simple linear regression fitted to the data.](index_files/figure-html/fig-plot-lm-1.png){#fig-plot-lm fig-align='center' fig-pos='h' width=1800}\n:::\n:::\n\n@fig-plot-lm show relationships between `body_mass_g` and `bill_depth_mm`. Looking at these points, I can see 2 clouds of points: the upper-left group and the lower-right group.\n\nBy looking at the line, something strange is happening here, the line connects 2 clouds of points together with *downward* sloping; an increase in `bill_depth_mm` corresponding to a decrease of `body_mass_g` !\n\nIt's a little weird right ?\n\nI will explore this further, but for now let's assume that it is OK and continue to fit the model.\n\n## Fitting Model\n\nI will use `lm()` function to fit the model, then the model's summary will be shown by `summary()`.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npen_lm_fit_simple <- lm(body_mass_g ~ bill_depth_mm, data = penguins)\nsummary(pen_lm_fit_simple)\n#> \n#> Call:\n#> lm(formula = body_mass_g ~ bill_depth_mm, data = penguins)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -1607.38  -510.10   -66.96   462.43  1819.28 \n#> \n#> Coefficients:\n#>               Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)    7488.65     335.22   22.34   <2e-16 ***\n#> bill_depth_mm  -191.64      19.42   -9.87   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 708.1 on 340 degrees of freedom\n#>   (2 observations deleted due to missingness)\n#> Multiple R-squared:  0.2227,\tAdjusted R-squared:  0.2204 \n#> F-statistic: 97.41 on 1 and 340 DF,  p-value: < 2.2e-16\n```\n:::\n\n`broom::glance()` will return model's summary in a one-row tibble which can be easier to manipulate it later.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbroom::glance(pen_lm_fit_simple)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-responsive\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> r.squared </th>\n   <th style=\"text-align:right;\"> adj.r.squared </th>\n   <th style=\"text-align:right;\"> sigma </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> logLik </th>\n   <th style=\"text-align:right;\"> AIC </th>\n   <th style=\"text-align:right;\"> BIC </th>\n   <th style=\"text-align:right;\"> deviance </th>\n   <th style=\"text-align:right;\"> df.residual </th>\n   <th style=\"text-align:right;\"> nobs </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0.2227044 </td>\n   <td style=\"text-align:right;\"> 0.2204182 </td>\n   <td style=\"text-align:right;\"> 708.0772 </td>\n   <td style=\"text-align:right;\"> 97.414 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> -2728.667 </td>\n   <td style=\"text-align:right;\"> 5463.334 </td>\n   <td style=\"text-align:right;\"> 5474.839 </td>\n   <td style=\"text-align:right;\"> 170466918 </td>\n   <td style=\"text-align:right;\"> 340 </td>\n   <td style=\"text-align:right;\"> 342 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\n\n\n## Summary\n\n::: callout-tip\n## Model Summary\n\nThe linear regression model of `body_mass_g` on `bill_depth_mm` has an adjusted R^2^ = 0.22, p-value \\< 0.001; meaning that this model is statistically significant and 22% of variation in `body_mass_g` can be explained by `bill_depth_mm`.\n:::\n\n**Automated Report**\n\n\n```{.r .cell-code  code-fold=\"true\"}\nreport::report(pen_lm_fit_simple)  %>% summary() \n```\n\nWe fitted a linear model to predict body_mass_g with bill_depth_mm. The model's explanatory power is moderate (R2 = 0.22, adj. R2 = 0.22). The model's intercept is at 7488.65 (95% CI [6829.29, 8148.01]). Within this model:\n\n  - The effect of bill depth mm is statistically significant and negative (beta = -191.64, 95% CI [-229.84, -153.45], t(340) = -9.87, p < .001, Std. beta = -0.47)\n\n## Coefficient\n\n\n\nThe estimated model coefficients can be written as @eq-pen-sim.\n\n$$\n\\widehat{Wt} = 7488.7 - 191.6 \\times Bill.Depth\n$$ {#eq-pen-sim}\n\n::: callout-tip\n## Coefficient Interpretation\n\nEvery 1 mm increases in bill depth corresponds to an *estimated* decreases of weight by -191.6 kg.\n:::\n\n------------------------------------------------------------------------\n\n# Multiple Linear Regression\n\nNow, let's add `species` to our linear model.\n\n::: callout-tip\n## Goal\n\nPredict `body_mass_g` using 2 predictors: `bill_depth_mm` and `species`.\n:::\n\n## Plotting\n\nLet's make a scatter plot similar to @fig-plot-lm with colors added to `species`.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np2 <- penguins %>% \n  ggplot(aes(bill_depth_mm, body_mass_g, color = species, shape = species)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  scale_color_brewer(palette = \"Set2\") +\n  labs(title = \"Multiple Linear Regression\")\n\np2\n```\n\n::: {.cell-output-display}\n![3 linear regressions by each `species`](index_files/figure-html/fig-plot-lm2-1.png){#fig-plot-lm2 fig-align='center' fig-pos='h' width=1800}\n:::\n:::\n\n\n\nIn @fig-plot-lm2, with `color = species` added to the plot, we can see that the upper-left cloud of points are **Gentoo** species and the lower-right are **Adelie** and **Chinstrap**. The interesting thing here is the 3 regression lines that fitted to each species has an *upward* slope which is contrast to the @fig-plot-lm.\n\n::: callout-note\n## Compare Plots\n\nYou can see the plots of simple vs multiple linear regression side-by-side here.\n:::\n\n::: {.cell .column-screen-inset-shaded layout-nrow=\"1\" layout-align=\"center\"}\n::: {.cell-output-display}\n![](index_files/figure-html/p1-p2-1.png){fig-align='center' fig-pos='h' width=1800}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/p1-p2-2.png){fig-align='center' fig-pos='h' width=1800}\n:::\n:::\n\n## Fitting Model\n\nNext, The model will be fitted once again with an outcome variable: `body_mass_g` , and predictors: `bill_depth_mm` and `species`. I will use `broom::tidy()` to show model coefficients.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npen_lm_fit_multi <- lm(body_mass_g ~ bill_depth_mm + species, data = penguins)\n\nbroom::tidy(pen_lm_fit_multi)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-responsive\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -1007.28112 </td>\n   <td style=\"text-align:right;\"> 323.56097 </td>\n   <td style=\"text-align:right;\"> -3.1131107 </td>\n   <td style=\"text-align:right;\"> 0.0020093 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> bill_depth_mm </td>\n   <td style=\"text-align:right;\"> 256.61461 </td>\n   <td style=\"text-align:right;\"> 17.56282 </td>\n   <td style=\"text-align:right;\"> 14.6112380 </td>\n   <td style=\"text-align:right;\"> 0.0000000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> speciesChinstrap </td>\n   <td style=\"text-align:right;\"> 13.37732 </td>\n   <td style=\"text-align:right;\"> 52.94712 </td>\n   <td style=\"text-align:right;\"> 0.2526544 </td>\n   <td style=\"text-align:right;\"> 0.8006889 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> speciesGentoo </td>\n   <td style=\"text-align:right;\"> 2238.66811 </td>\n   <td style=\"text-align:right;\"> 73.68183 </td>\n   <td style=\"text-align:right;\"> 30.3829071 </td>\n   <td style=\"text-align:right;\"> 0.0000000 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\n\n\n`broom::glance()` shows model overview as one-row data frame.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbroom::glance(pen_lm_fit_multi)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-responsive\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> r.squared </th>\n   <th style=\"text-align:right;\"> adj.r.squared </th>\n   <th style=\"text-align:right;\"> sigma </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> df </th>\n   <th style=\"text-align:right;\"> logLik </th>\n   <th style=\"text-align:right;\"> AIC </th>\n   <th style=\"text-align:right;\"> BIC </th>\n   <th style=\"text-align:right;\"> deviance </th>\n   <th style=\"text-align:right;\"> df.residual </th>\n   <th style=\"text-align:right;\"> nobs </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0.7975462 </td>\n   <td style=\"text-align:right;\"> 0.7957493 </td>\n   <td style=\"text-align:right;\"> 362.4362 </td>\n   <td style=\"text-align:right;\"> 443.839 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> -2498.619 </td>\n   <td style=\"text-align:right;\"> 5007.239 </td>\n   <td style=\"text-align:right;\"> 5026.413 </td>\n   <td style=\"text-align:right;\"> 44399670 </td>\n   <td style=\"text-align:right;\"> 338 </td>\n   <td style=\"text-align:right;\"> 342 </td>\n  </tr>\n</tbody>\n</table>\n`````\n:::\n:::\n\n\n\n## Summary\n\n::: callout-tip\n## Model Summary\n\nThe linear regression model of `body_mass_g` on `bill_depth_mm` and `species` has an adjusted R^2^ = 0.8, p-value \\< 0.001; meaning that this model is statistically significant and 22% of variation in `body_mass_g` can be explained by `bill_depth_mm` and `species`.\n:::\n\n**Automated Report**\n\n\n```{.r .cell-code  code-fold=\"true\"}\nreport::report(pen_lm_fit_multi)  %>% summary() \n```\n\nWe fitted a linear model to predict body_mass_g with bill_depth_mm and species. The model's explanatory power is substantial (R2 = 0.80, adj. R2 = 0.80). The model's intercept is at -1007.28 (95% CI [-1643.73, -370.83]). Within this model:\n\n  - The effect of bill depth mm is statistically significant and positive (beta = 256.61, 95% CI [222.07, 291.16], t(338) = 14.61, p < .001, Std. beta = 0.63)\n  - The effect of species [Chinstrap] is statistically non-significant and positive (beta = 13.38, 95% CI [-90.77, 117.52], t(338) = 0.25, p = 0.801, Std. beta = 0.02)\n  - The effect of species [Gentoo] is statistically significant and positive (beta = 2238.67, 95% CI [2093.74, 2383.60], t(338) = 30.38, p < .001, Std. beta = 2.79)\n\n## Coefficient\n\nThe estimated model coefficients can be written as @eq-pen-multi1.\n\n$$\n\\begin{aligned}\n\\widehat{Wt} = &- 1007.3 \\\\\n               &+ 256.6 \\times Bill.Depth \\\\\n               &+ 13.4 \\times SP_{Chinstrap} \\\\\n               &+ 2238.7 \\times SP_{Gentoo}\n\\end{aligned}\n$$ {#eq-pen-multi1}\n\nI use the notation $Var_{LV}$ to represent **indicator variables** for when the categorical variable takes a particular value. For example $SP_{Chinstrap}$ would take a value of 1 if the `species` is \"Chinstrap\", and it would take a value of 0 otherwise. The same logic also applies to \"Gentoo\".\n\nWe have seen from the @fig-plot-lm2 that the models can be visualized as 3 regression lines for each species. Now we shall see whether coefficient of the model agree with the plot.\n\n\n\n### Slope\n\nThe slope of the line is the coefficient of $Bill.Depth$ as given by @eq-pen-multi1, It means that **the slope of each 3 lines is the same** (= 256.6).\n\n::: callout-tip\n## Slope Interpretation\n\nFor every 1 mm increases in `bill_depth_mm` in any given `species` corresponds to an *estimated* increases in `body_mass_g` of 256.6.\n:::\n\n::: callout-caution\n## Important\n\nIn this multiple regression example, It can be seen that the coefficient of `bill_depth_mm` after **adjusting for `species`** (256.6) is **not** the same as before when it is the only predictor (-191.6).\n:::\n\n### Distances between Lines\n\nWe can estimate differences in `body_mass_g` among `species` when taking `bill_depth_mm` into account using @eq-pen-multi1. The **\"Adelie\"** species is considered as baseline.\n\nFor example, using $SP_{Gentoo}$ coefficient, we could say that **\"Gentoo\"** has an estimated weight of 2238.7 (g) more than **\"Adelie\"** for any given `bill_depth_mm`. Note that the effect of **\"Chinstrap\"** is non-significant as we can already see in the @fig-plot-lm2 that Chinstrap's line and Adelie's line are, in fact, very close.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": [],
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}